
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>STEP import and meshing &#8212; TMR 1 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Orthogonal bracket" href="orthogonal_bracket.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="orthogonal_bracket.html" title="Orthogonal bracket"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TMR 1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="orthogonal_bracket.html"
                        title="previous chapter">Orthogonal bracket</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/example.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="step-import-and-meshing">
<h1>STEP import and meshing<a class="headerlink" href="#step-import-and-meshing" title="Permalink to this headline">Â¶</a></h1>
<p>The following example loads in a CAD model from a STEP file, and creates a volume mesh.
The code consists of the following steps:</p>
<ul class="simple">
<li><p>Import the CAD model from a STEP geometry file into a TMR-compatible objects using <code class="docutils literal notranslate"><span class="pre">TMR.LoadModel</span></code></p></li>
<li><p>Extract lists of the volumes, faces and edges defined from the file</p></li>
<li><p>Set source and target edges and faces. In the source-target relationship, target edges will have the same number of nodes as their source. Target faces will have the same surface mesh topology as their source faces. Source and target faces must be in the same volume object.</p></li>
<li><p>The call <code class="docutils literal notranslate"><span class="pre">mesh</span> <span class="pre">=</span> <span class="pre">TMR.Mesh(comm,</span> <span class="pre">geo)</span></code> generates a new mesh. If the model input contains vertices, edges and faces, then a surface mesh is created, if it also contains volumes, then a volume mesh is created.</p></li>
</ul>
<p>Listed below is an example of using TMR to generate a quadtree/octree mesh</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">tmr</span> <span class="kn">import</span> <span class="n">TMR</span>

<span class="c1"># Set the communicator</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># Load the model from the STEP file</span>
<span class="n">geo</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">LoadModel</span><span class="p">(</span><span class="s1">&#39;geometry.stp&#39;</span><span class="p">)</span>

<span class="c1"># Get the volumes</span>
<span class="n">vols</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">getVolumes</span><span class="p">()</span>

<span class="c1"># Get the edges/faces from the geometry</span>
<span class="n">faces</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">getFaces</span><span class="p">()</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">getEdges</span><span class="p">()</span>

<span class="c1"># Set the source/target relationships</span>
<span class="n">faces</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">setSource</span><span class="p">(</span><span class="n">vols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">faces</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">edges</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">setSource</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

<span class="c1"># Create the geometry</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">geo</span><span class="p">)</span>

<span class="c1"># Mesh the part</span>
<span class="n">opts</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">MeshOptions</span><span class="p">()</span>
<span class="n">opts</span><span class="o">.</span><span class="n">num_smoothing_steps</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Mesh the geometry with the given target size</span>
<span class="n">htarget</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">htarget</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)</span>
</pre></div>
</div>
<p>It is sometimes necessary to identify the numbering of vertex, edges, faces, and volumes within a file.
A convenient way to visualize this information is to create a tecplot file with labels.
An example of generating this information is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">tmr</span> <span class="kn">import</span> <span class="n">TMR</span>

<span class="c1"># Set the communicator</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># Load the model from the STEP file</span>
<span class="n">geo</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">LoadModel</span><span class="p">(</span><span class="s1">&#39;geometry.stp&#39;</span><span class="p">)</span>

<span class="c1"># Output the geometry model with the numbering convention</span>
<span class="n">geo</span><span class="o">.</span><span class="n">writeModelToTecplot</span><span class="p">(</span><span class="s1">&#39;tecplot_surfaces.dat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="orthogonal_bracket.html" title="Orthogonal bracket"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TMR 1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Graeme J. Kennedy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>