
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Common Research Model (CRM) wingbox &#8212; TMR 1 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interpolation between meshes" href="interp.html" />
    <link rel="prev" title="STEP import and meshing" href="example.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="interp.html" title="Interpolation between meshes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="example.html" title="STEP import and meshing"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TMR 1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="example.html"
                        title="previous chapter">STEP import and meshing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="interp.html"
                        title="next chapter">Interpolation between meshes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/crm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="common-research-model-crm-wingbox">
<h1>Common Research Model (CRM) wingbox<a class="headerlink" href="#common-research-model-crm-wingbox" title="Permalink to this headline">Â¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">egads4py</span></code> can be used to create wingbox models that can then be meshed with TMR.
An example of this application can be found under <code class="docutils literal notranslate"><span class="pre">examples/egads/crm</span></code> which generates a STEP model of the undeformed CRM wing.
In this example, there are two steps to the creation of the STEP file:</p>
<ol class="arabic simple">
<li><p>The code <code class="docutils literal notranslate"><span class="pre">oml.py</span></code> reads in the IGES surface file and extracts the lofted airfoil curves.
These curves are not all planar, so they are modified slightly and are projected so that they are parallel with the symmetry plane.
This modified OML geometry is then written to the files <code class="docutils literal notranslate"><span class="pre">ucrm_9_oml.egads</span></code> and <code class="docutils literal notranslate"><span class="pre">ucrm_9_oml.step</span></code>.</p></li>
<li><p>The code <code class="docutils literal notranslate"><span class="pre">crm.py</span></code> reads in the OML geometry.
This code uses a doubly-connected edge loop (DCEL) data structure to create a planar layout of ribs and spars.
This planar layout is then extruded in the vertical direction.
The intersections between the ribs and spars and OML are computed and imprinted and the leading edge, trailing edge, and upper/lower spars and ribs.</p></li>
</ol>
<img alt="_images/crm.png" src="_images/crm.png" />
<p>Next, the <code class="docutils literal notranslate"><span class="pre">ucrm_9_model.step</span></code> file generated can be run through the example code in <code class="docutils literal notranslate"><span class="pre">examples/step/step_import.py</span></code> to generate the following unstructured quadrilateral mesh:</p>
<img alt="_images/crm_mesh.png" src="_images/crm_mesh.png" />
<p>This code consists of the following steps:</p>
<ul class="simple">
<li><p>The command-line arguments are parsed to obtain <code class="docutils literal notranslate"><span class="pre">htarget</span></code> the global mesh spacing, <code class="docutils literal notranslate"><span class="pre">filename</span></code> the input file name, and <code class="docutils literal notranslate"><span class="pre">output</span></code> the optional output file name</p></li>
<li><p>A <a class="reference internal" href="geometry_interface.html#tmr.TMR.Model" title="tmr.TMR.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> instance is created by loading the STEP file <code class="docutils literal notranslate"><span class="pre">geo</span> <span class="pre">=</span> <span class="pre">TMR.LoadModel(filename)</span></code></p></li>
<li><p>A new <a class="reference internal" href="geometry_interface.html#tmr.TMR.Model" title="tmr.TMR.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> instance is created by discarding any <a class="reference internal" href="geometry_interface.html#tmr.TMR.Volume" title="tmr.TMR.Volume"><code class="xref py py-class docutils literal notranslate"><span class="pre">Volume</span></code></a> objects from the model</p></li>
<li><p>Mesh options are set and the model is meshed, generating a new output</p></li>
<li><p>The final mesh is written to a VTK file</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">tmr</span> <span class="kn">import</span> <span class="n">TMR</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Set the communicator</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># Create an argument parser to read in arguments from the commnad line</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--htarget&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--filename&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;STEP file name&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;surface-mesh.vtk&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output file name&#39;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># Get the value of the filename</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">filename</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

<span class="c1"># Set the value of the target length scale in the mesh</span>
<span class="n">htarget</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">htarget</span>

<span class="c1"># Load the geometry model</span>
<span class="n">geo</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">LoadModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># Create a model by discarding the volumes</span>
<span class="n">verts</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">getEdges</span><span class="p">()</span>
<span class="n">faces</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">getFaces</span><span class="p">()</span>
<span class="n">geo_new</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>

<span class="c1"># Create the new mesh</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">geo_new</span><span class="p">)</span>

<span class="c1"># Set the meshing options</span>
<span class="n">opts</span> <span class="o">=</span> <span class="n">TMR</span><span class="o">.</span><span class="n">MeshOptions</span><span class="p">()</span>
<span class="n">opts</span><span class="o">.</span><span class="n">write_mesh_quality_histogram</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">opts</span><span class="o">.</span><span class="n">triangularize_print_iter</span> <span class="o">=</span> <span class="mi">50000</span>

<span class="c1"># Create the surface mesh</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">htarget</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>

<span class="c1"># Write the surface mesh to a file</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">writeToVTK</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="interp.html" title="Interpolation between meshes"
             >next</a> |</li>
        <li class="right" >
          <a href="example.html" title="STEP import and meshing"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TMR 1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Graeme J. Kennedy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>